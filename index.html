<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Chat!</title>
    <link rel="stylesheet" type="text/css" media="screen" href="style.css" />
    <!-- <script src="main.js"></script> -->
</head>

<body>
    <h1>Chat App!</h1>
    <div id='form-input'>
        <form id='chat-form' action='chat' method='POST'>
            <input id='messageBody' type='text' author='body'>
            <input type='submit'>
        </form>
    </div>
    <div id='chat-log'></div>

    <script>
        let chatForm = document.getElementById('chat-form')
        let chatLog = document.getElementById('chat-log')
        chatForm.addEventListener('submit', (event) => {
            let inputElement = chatForm.querySelector('input[author=body]')
            let message = inputElement.value;
            let params = new URLSearchParams();
            params.append('body', message);

            fetch('/chat', {
                method: 'POST',
                body: params
            }).then(response => response.json())
                .then(messages => {
                    chatLog.innerHTML = messages.map(message => message.body).join('<br>')
                })
            event.preventDefault();
        })
        // if (document.URL.includes('/chat')) {
        //     console.log("get fetch")
        //     let mostRecentMessageAt = messages[messages.length - 1].when
        //     console.log(mostRecentMessageAt)
        //     fetch('/chat?since=' + mostRecentMessageAt, {
        //         method: 'GET'
        //     })
        //         .then(response => response.json())
        //         .then(messages => {
        //             sendMessages()
        //         })
        // }

    </script>
</body>

</html>